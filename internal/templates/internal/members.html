{% extends "internal/base.html" %}
{% load i18n %}
{% load staticfiles %}
{% load member %}

{% block title %}{% trans "Members list" %}{% endblock %}

{% block head %}
    <link rel="stylesheet" href="{% static "internal/css/members.css" %}">
{% endblock %}

{% block body %}

    <div class="ui container">
        <h1>{% trans "Members list" %}</h1>

        <form class="ui form">
            <div class="ui fields">
                <div class="ui multiple blue labeled button icon dropdown">
                    <input type="hidden" name="filter-state">
                    <i class="ui filter icon"></i>
                    <span class="ui text">Filter Membership State</span>
                    <div class="menu">
                        <div class="scrolling menu">
                            <div class="item" data-value="{% trans "Active" %}">
                                <i class="ui green circle icon"></i>{% trans "Active" %}
                            </div>
                            <div class="item" data-value="{% trans "Inactive" %}">
                                <i class="ui grey circle icon"></i>{% trans "Inactive" %}
                            </div>
                            <div class="item" data-value="{% trans "Pang" %}">
                                <i class="ui blue circle icon"></i>{% trans "Pang" %}
                            </div>
                            <div class="item" data-value="{% trans "Honorary" %}">
                                <i class="ui yellow circle icon"></i>{% trans "Honorary" %}
                            </div>
                            <div class="item" data-value="{% trans "Quit" %}">
                                <i class="ui red circle icon"></i>{% trans "Quit" %}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ui multiple blue labeled button icon dropdown">
                    <input type="hidden" name="filter-committee">
                    <i class="ui filter icon"></i>
                    <span class="ui text">Filter Committees</span>
                    <div class="menu">
                        <div class="scrolling menu">
                            <div class="item" data-value="Dev">
                                <i class="ui green circle icon"></i>Dev
                            </div>
                            <div class="item" data-value="Mentor">
                                <i class="ui red circle icon"></i>Mentor
                            </div>
                            <div class="item" data-value="Event">
                                <i class="ui blue circle icon"></i>Event
                            </div>
                            <div class="item" data-value="PR">
                                <i class="ui yellow circle icon"></i>PR
                            </div>
                            <div class="item" data-value="Styret">
                                <i class="ui purple circle icon"></i>Styret
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
        <table class="ui celled unstackable selectable striped table" id="member-table">
            <thead>
            <tr>
                <th>Name</th>
                <th>Committees</th>
                <th>Joined</th>
                <th>Email</th>
            </tr>
            </thead>
            <tbody>
            {% for member in object_list %}
                {% get_committees member as committees %}
                <tr data-name="{{ member.user.get_full_name }}"
                    data-state='{% get_membership_states member %}'
                    data-phone="{{ member.phone_number }}"
                    data-email="{% if member.email %}{{ member.email }}{% endif %}"
                    data-card-number="{{ member.card_number }}"
                    data-study-program="{{ member.study_program }}"
                    data-system-accesses="{% get_system_accesses member %}"
                    data-term-joined="{{ member.term_joined }}"
                    data-date-joined="{{ member.date_joined|date:"d.m.y" }}"
                    data-term-quit="{% if member.quit %}{{ member.term_quit }}{% endif %}"
                    data-date-quit="{% if member.quit %}{{ member.date_quit }}{% endif %}"
                    data-reason-quit="{% if member.quit %}{{ member.reason_quit }}{% endif %}"
                    data-role="{{ member.role }}"
                    data-committees="{{ committees }}"
                    data-comment="{{ member.comment }}"
                    data-guidance-exemption="{% if member.guidance_exemption %}{% trans "Yes" %}{% else %}{% trans "No" %}{% endif %}"
                >
                    <td>{{ member.user.get_full_name }}</td>
                    <td>
                        {% for committee_name, color in committees %}
                            <div class="ui {{ color }} label">{{ committee_name }}</div>
                        {% endfor %}
                    </td>
                    <td>
                        {{ member.term_joined }}
                    </td>
                    <td>
                        {% if member.email %}<a href="mailto:{{ member.email }}">{{ member.email }}</a>{% endif %}
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    {# Modal for showing detailed information about the user #}
    <div class="ui inverted longer modal" id="detailed-member-info">
        <div class="header">
            <span id="member-name-header"></span>
            <span style="float: right" id="member-state-header"></span>
        </div>
        <div class="scrolling content">
            <h4 class="ui horizontal divider header">
                <i class="ui yellow user icon"></i>{% trans "Basic information" %}
            </h4>
            <table class="ui very basic unstackable celled table">
                <tbody>
                <tr>
                    <td class="six wide column"><b>{% trans "Name" %}</b></td>
                    <td id="member-name"></td>
                </tr>
                <tr>
                    <td><b>{% trans "Phone" %}</b></td>
                    <td id="member-phone"></td>
                </tr>
                <tr>
                    <td><b>{% trans "Email" %}</b></td>
                    <td><b><a id="member-email"></a></b></td>
                </tr>
                <tr>
                    <td><b>{% trans "Card number" %}</b></td>
                    <td id="member-card-number"></td>
                </tr>
                <tr>
                    <td><b>{% trans "Study program" %}</b></td>
                    <td id="member-study-program"></td>
                </tr>
                </tbody>
            </table>

            <h4 class="ui horizontal divider header">
                <i class="ui yellow users icon"></i>{% trans "Membership information" %}
            </h4>
            <table class="ui very basic unstackable celled table">
                <tbody>
                <tr>
                    <td class="six wide column"><b>{% trans "Joined" %}</b></td>
                    <td id="member-joined"></td>
                </tr>
                <tr>
                    <td><b>{% trans "Quit" %}</b></td>
                    <td id="member-quit"></td>
                </tr>
                <tr>
                    <td><b>{% trans "Reason quit" %}</b></td>
                    <td id="member-quit-reason"></td>
                </tr>
                <tr>
                    <td><b>{% trans "Status" %}</b></td>
                    <td id="member-state"></td>
                </tr>
                <tr>
                    <td><b>{% trans "Committee" %}</b></td>
                    <td id="member-committee"></td>
                </tr>
                <tr>
                    <td><b>{% trans "Role" %}</b></td>
                    <td id="member-role"></td>
                </tr>
                <tr>
                    <td><b>{% trans "Guidance exemption" %}</b></td>
                    <td id="member-guidance-exemption"></td>
                </tr>
                <tr>
                    <td><b>{% trans "Comment" %}</b></td>
                    <td id="member-comment"></td>
                </tr>
                </tbody>
            </table>

            <h4 class="ui horizontal divider header">
                <i class="ui yellow key icon"></i>{% trans "System accesses" %}
            </h4>
            <table class="ui very basic unstackable celled table">
                <tbody id="member-system-accesses">

                </tbody>
            </table>
        </div>
    </div>

{% endblock %}

{% block scripts %}
    {{ super.block }}
    <script>
        $("div.ui.dropdown").dropdown();
        $("input[name=filter-state]").parent().dropdown("set selected", ["{% trans "Active" %}"]);
    </script>
    <script src="{% static "internal/js/members.js" %}"></script>
{% endblock %}