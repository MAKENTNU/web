{% load staticfiles %}
{% load i18n %}
{% load string_tags %}
{% load permission_tags %}
{% get_current_language as LANGUAGE_CODE %}

<link rel="stylesheet" type="text/css" href="{% static "web/css/header.css" %}">

<header id="header">
    <div class="logo-centering">{# Empty div for centering logo (on mobile), specified with grid-template-columns #}</div>

    <div class="logo">
        <div>{# Empty div for spacing left of logo, specified with grid-template-columns #}</div>
        <a href="{% url 'front-page' %}">
            <img class="limg large" src="{% static "web/img/logo_white.svg" %}">
            <img class="limg medium" src="{% static "web/img/logo_make.svg" %}">
            <img class="limg small" src="{% static "web/img/logo_m.svg" %}">
        </a>
    </div>

    <div id="burger">
        <i class="sidebar icon"></i>
    </div>

    <nav id="nav" class="ui secondary inverted menu">
        <a class="nav-item item" href="{% url 'events' %}">
            <div class="nav-item-text">{% trans "Events" %}</div>
        </a>
        <a class="nav-item item" href="{% url 'articles' %}">
            <div class="nav-item-text">{% trans "Articles" %}</div>
        </a>
        <a class="nav-item item" href="{% url 'reservation_machines_overview' %}">
            <div class="nav-item-text">{% trans "Reservations" %}</div>
        </a>
        <a class="nav-item item" href="{% url 'makerspace' %}">
            <div class="nav-item-text">{% trans "Makerverkstedet" %}</div>
        </a>
        <a class="nav-item item" href="{% url 'about' %}">
            <div class="nav-item-text">{% trans "About us" %}</div>
        </a>
    </nav>

    <div id="side-nav" class="ui secondary menu">
        {% if user.is_authenticated %}
            <div id="nav-user-dropdown" class="nav-item ui dropdown item">
                <div class="nav-item-text">{{ user.first_name|first_word }}</div>
                <i class="dropdown icon nav-item-text" tabindex{# For disabling focus on click #}></i>

                <div class="menu transition hidden">
                    {% if user|has_any_permissions or user.is_superuser %}
                        <a class="dropdown-item item" href="{% url 'adminpanel' %}">
                            <div class="dropdown-item-text">{% trans "Administration" %}</div>
                        </a>
                    {% endif %}
                    <a class="dropdown-item item" href="{% url 'profile' %}">
                        <div class="dropdown-item-text">{% trans "Profile" %}</div>
                    </a>
                    <a class="dropdown-item item" href="{% url 'logout' %}">
                        <div class="dropdown-item-text">{% trans "Logout" %}</div>
                    </a>
                </div>

            </div>
        {% else %}
            <a class="nav-item item" href="{% url 'login' %}">
                <div class="nav-item-text">{% trans "Login" %}</div>
            </a>
        {% endif %}

        <div class="lang-link ui inverted secondary menu">
            <div class="ui language link item">
                <div class="text">
                    {% if LANGUAGE_CODE == "en" %}
                        Norsk
                    {% else %}
                        English
                    {% endif %}
                </div>
                <i class="globe icon text"></i>
            </div>
        </div>

    </div>
</header>

{# This form is hidden, but is submitted through JQuery #}
<form class="lang-form" action="{% url 'set_language' %}" method="POST">
    {% csrf_token %}
    {% if LANGUAGE_CODE == "en" %}
        <input name="language" type="hidden" value="nb"/>
        <input name="next" type="hidden" value="{{ request.get_full_path|slice:"3:" }}"/>
    {% else %}
        <input name="language" type="hidden" value="en"/>
        <input name="next" type="hidden" value="/en{{ request.get_full_path }}"/>
    {% endif %}
    <input type="submit"/>
</form>

<script>
    $('#nav-user-dropdown').dropdown({action: "nothing"});
    $(".lang-link").click(function (event) {
        event.preventDefault();
        $(".lang-form").submit();
    });
    $('#burger').click(function () {
        $('#header').toggleClass('active');
    });
</script>
