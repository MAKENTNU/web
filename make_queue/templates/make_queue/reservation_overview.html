{% extends "web/base.html" %}
{% load staticfiles %}
{% load i18n %}
{% load reservation_extra %}

{% block head %}
    <script type="text/javascript" src="{% static 'web/calendar/calendar.min.js' %}"></script>
    <link rel="stylesheet" href="{% static 'web/calendar/calendar.min.css' %}">
    <link rel="stylesheet" href="{% static 'make_queue/css/general.css' %}">
    <link rel="stylesheet" href="{% static 'make_queue/css/overview.css' %}">
{% endblock %}

{% block title %}
    {{ machine.name }} - {{ machine.machine_model }}
{% endblock %}

{% block body %}
    {% can_use_machine machine user as can_use %}
    <div class="ui container">
        {% csrf_token %}
        <div class="ui machine-title-field">
            <div class="ui huge header machine-title">
                {{ machine.name }}
            </div>
            <a href="{% url "machine_usage_rules" machine.machine_type %}">({% trans "Rules" %})</a>
        </div>
        <div class="ui three column padded grid">
            <div class="ui row">
                <div class="ui no padding column">
                    <h3>{% trans "About the machine" %}</h3>
                    <div class="ui relaxed list">
                        <div class="item">
                            <i class="ui large middle aligned make_col_yellow location arrow icon"></i>
                            <div class="content">
                                <div class="header">{% trans "Location" %}</div>
                                <a href="{{ machine.location_url }}">{{ machine.location }}</a>
                            </div>
                        </div>
                        <div class="item">
                            <i class="ui large middle aligned make_col_yellow cog icon"></i>
                            <div class="content">
                                <div class="header">{% trans "Machine type" %}</div>
                                {{ machine.machine_type.name }}
                            </div>
                        </div>
                        <div class="item">
                            <i class="ui large middle aligned make_col_yellow wrench icon"></i>
                            <div class="content">
                                <div class="header">{% trans "Model" %}</div>
                                {{ machine.machine_model }}
                            </div>
                        </div>
                        <div class="item">
                            <i class="ui large middle make_col_yellow aligned info circle icon"></i>
                            <div class="content">
                                <div class="header">{% trans "Status" %}</div>
                                <span class="ui {% card_color_from_machine_status machine %} text tiny header">
                                {% card_text_from_machine_status machine %}
                            </span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="ui column">
                    <h3>Actions</h3>
                    <div class="ui relaxed divided selection action list">
                        <a class="item {% if not can_use or not can_make_more_reservations %}disable{% endif %} enable_popup"
                                {% if not user.is_authenticated %}
                           data-content="{% trans "You must be logged in to make new reservations" %}"
                                {% elif not can_use %}
                           data-content="{% get_machine_cannot_use_text machine %}"
                                {% elif not can_make_more_reservations %}
                           data-content="{% trans "You have reached the maximum number of future reservations" %}"
                                {% endif %}
                           href="{% url 'make_reservation' machine=machine %}">
                            <i class="large middle aligned make_col_yellow plus icon"></i>
                            <div class="content">
                                <div class="header">{% trans "New reservation" %}</div>
                                {% trans "Click to create a new reservation" %}
                            </div>
                        </a>
                        <a href="{% url "my_reservations" %}" class="item">
                            <i class="large middle aligned make_col_yellow list ul icon"></i>
                            <div class="content">
                                <div class="header">{% trans "My reservations" %}</div>
                                {% trans "Click to see your reservations" %}
                            </div>
                        </a>
                        <div class="ui right dropdown item">
                            <div class="right floated content">
                                <i class="ui large make_col_yellow dropdown icon"></i>
                            </div>
                            <i class="large middle aligned make_col_yellow cogs icon"></i>
                            <div class="content" id="test">
                                <div class="header">{% trans "Other machines" %}</div>
                                {% trans "Click to see other machines" %}
                            </div>
                            <div class="ui transition bottom hidden popup">
                                <div class="ui padded grid">
                                    Test
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="ui right floated no padding column">
                    {% if machine.machine_type.has_stream %}
                        <div class="ui right floated medium image">
                            <img class="stream image" name="{{ machine.name }}"
                                 style="border: 1px solid #A5BBC9;border-radius: .28571429rem;"
                                 src="{% static "make_queue/img/no_stream.jpg" %}">
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
        <!-- <div class="ui grid padded equal width ">
            <div class="column">
                <div class="ui cards">
                    {% include 'make_queue/machine_card.html' with machine=machine color_bottom=1 %}
                </div>
            </div>
            <div class="column no padding">
                <div class="ui vertical buttons make_right_floated">
                    <div class="enable_popup"
                            {% if not user.is_authenticated %}
                         data-content="{% trans "You must be logged in to make new reservations" %}"
                            {% elif not can_use %}
                         data-content="{% get_machine_cannot_use_text machine %}"
                            {% elif not can_make_more_reservations %}
                         data-content="{% trans "You have reached the maximum number of future reservations" %}"
                            {% endif %}>
                        <a class="ui labeled icon wrapped make_yellow button
                {% if not can_use or not can_make_more_reservations %}disabled{% endif %}"
                           href="{% url 'make_reservation' machine=machine %}">
                            <i class="add icon"></i>
                            {% trans "New reservation" %}
                        </a>
                    </div>
                    <a class="ui labeled icon make_yellow button" href="{% url 'my_reservations' %}">
                        <i class="list icon"></i>
                        {% trans "My reservations" %}
                    </a>
                    <a class="ui labeled icon make_yellow button" href="{% url 'reservation_machines_overview' %}">
                        <i class="cogs icon"></i>
                        {% trans "Other machines" %}
                    </a>
                </div>
            </div>
        </div>-->
        {% url 'reservation_calendar' year=next.0 week=next.1 machine=machine as link_next %}
        {% url 'reservation_calendar' year=prev.0 week=prev.1 machine=machine as link_prev %}
        {% current_calendar_url machine as link_now %}
        {% include 'make_queue/reservation_calendar.html' with week_days=week_days link_prev=link_prev link_next=link_next %}
    </div>
    <script>let allowed = {% if can_make_more_reservations %}true{% else %}false{% endif %};</script>
    <script src="{% url 'javascript-catalog' %}"></script>
    <script src="{% static "make_queue/js/reservation_calendar.js" %}"></script>
{% endblock body %}
