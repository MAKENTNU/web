{% extends 'web/base.html' %}
{% load static %}
{% load i18n %}


{% block title %}{% trans "access"|capfirst %}{% endblock title %}

{% block extra_head %}
    <link rel="stylesheet" href="{% static 'make_queue/css/quota_panel.css' %}"/>
{% endblock extra_head %}

{% block body %}
    <div class="ui container">
        <a class="ui make-bg-yellow button" href="{% url 'create_quota' %}">
            <i class="ui icon plus"></i>{% trans "Add new quota" %}
        </a>
        <div class="ui tabular pointing secondary menu">
            <a class="{% if not requested_user %}active{% endif %} item" data-tab="global">{% trans "Global" %}</a>
            <a class="{% if requested_user %}active{% endif %} item" data-tab="users">{% trans "Users" %}</a>
        </div>
        <div class="quotas ui tab {% if not requested_user %}active{% endif %}" data-tab="global">
            {% for quota in global_quotas %}
                <div class="ui card">
                    <div class="content">
                        <div class="header">
                            {% if quota.dimishing %}
                                {% trans "One-time quota" %}
                            {% else %}
                                {% trans "Replenishing quota" %}
                            {% endif %}
                            <a href="{% url 'edit_quota' quota.pk %}">
                                <i class="ui make-col-yellow icon pencil"></i>
                            </a>
                            {% if perms.make_queue.delete_quota %}
                                <a class="delete-modal-button"
                                   data-url="{% url 'delete_quota' quota.pk %}"
                                   data-obj-name="{{ quota }}">
                                    <i class="ui red icon trash"></i>
                                </a>
                            {% endif %}
                        </div>
                        <div class="meta">{{ quota.machine_type.name }}</div>
                        <span>
                            <b>{% trans "Maximum number of reservations" %}:</b> {{ quota.number_of_reservations }}
                        </span>
                        {% if quota.ignore_rules %}
                            <b>{% trans "ignores rules"|capfirst %}</b>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        </div>
        <div class="ui {% if requested_user %}active{% endif %} tab" data-tab="users">
            <div class="ui fluid search selection dropdown">
                <input id="user" type="hidden" name="user"/>
                <i class="ui dropdown icon"></i>
                <div class="default text">{% trans "Select user" %}</div>
                <div class="menu">
                    {% for user in users %}
                        <div class="item" data-value="{{ user.pk }}">{{ user.get_full_name }}</div>
                    {% endfor %}
                </div>
            </div>
            <div class="make-content-padding"></div>
            <div id="user-quotas">

            </div>
        </div>
    </div>
    <script src="{% static 'make_queue/js/quota_panel.js' %}"></script>
    <script>
        $(".tabular.menu .item").tab();
        {% if requested_user %}
            $("#user").parent().dropdown("set selected", "{{ requested_user.pk }}");
        {% endif %}
    </script>
{% endblock body %}
