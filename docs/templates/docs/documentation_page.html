{% extends "docs/base.html" %}
{% load i18n %}
{% load staticfiles %}

{% block title %}{{ page.title }}{% endblock %}

{% block head %}
    <link rel="stylesheet" href="{% static "docs/css/documentation_page.css" %}">
{% endblock %}

{% block body %}
    <div class="ui container">
        {% if old %}
            <div class="ui warning message">
                <div class="ui header">
                    {% trans "You are viewing an old version of this page" %}
                </div>
                {% trans "You are viewing an old version of this page, where the last edit was made by" %}
                {% if content.made_by %}{{ content.made_by.get_full_name }}{% else %}{% trans "Anonymous" %}{% endif %}
                {% trans "on" %} {{ content.changed|date:"d.m.Y" }} {% trans "at" %} {{ content.changed|date:"H:i" }}.
                {% trans "To view the current version, click" %}
                <a href="{% url "page" pk=page %}">{% trans "here" %}</a>.
                {% trans "To change the current version to this one, click" %}
                <a href="" id="change-current-version">{% trans "here" %}</a>.
            </div>
        {% endif %}
        <h3 class="edit tools">
            <a href="{% url "page-history" pk=page %}" class="explanation-popup" data-title="{% trans "History" %}"
               data-content="{% trans "Click to view the content history of the page" %}">
                <i class="ui blue archive icon"></i>
            </a>
            {% if not old %}
                <a href="{% url "edit-page" pk=page %}" class="explanation-popup" data-title="{% trans "Edit" %}"
                   data-content="{% trans "Click to edit the content of the page" %}">
                    <i class="ui yellow edit icon"></i>
                </a>
                <a href="{% url "delete-page" pk=page %}" class="delete confirm explanation-popup"
                   data-title="{% trans "Delete" %}" data-content="{% trans "Click to delete the page" %}">
                    <i class="ui red trash icon"></i>
                </a>
            {% endif %}
        </h3>
        <h1>{{ page.title }}</h1>

        {% if content %}
            {% autoescape off %}
                {{ content.content }}
            {% endautoescape %}
        {% elif page.current_content %}
            {% autoescape off %}
                {{ page.current_content.content }}
            {% endautoescape %}
        {% else %}
            <i>
                {% trans "No content exists for this page, do you wish to" %}
                <a href="{% url "edit-page" pk=page %}">{% trans "create" %}</a>
                {% trans "some" %}?
            </i>
        {% endif %}
    </div>

    {% if form and old %}
        <form id="change-version-form" class="hidden form" method="POST"
              action="{% url "change-page-version" pk=page %}">
            {% csrf_token %}
            {{ form }}
        </form>
    {% endif %}
{% endblock %}

{% block scripts %}
    <script>
        $(".explanation-popup").popup();

        {% if old %}
            $("#change-current-version").click(() => {
                $("#change-version-form").submit();
                return false;
            });
        {% endif %}
    </script>
{% endblock %}