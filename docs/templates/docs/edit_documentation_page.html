{% extends "docs/base.html" %}
{% load i18n %}
{% load staticfiles %}

{% block title %}{% trans "Edit" %} "{{ page.title }}"{% endblock %}

{% block head %}
    <script type="text/javascript" src="{% static "ckeditor/ckeditor-init.js" %}"></script>
    <script type="text/javascript" src="{% static "ckeditor/ckeditor/ckeditor.js" %}"></script>
{% endblock head %}

{% block body %}
    <div class="ui container">
        <div class="ui transition hidden error message" id="empty-content-error">
            <i class="close icon"></i>
            <div class="header">{% trans "No content" %}</div>
            {% trans "The page is currently empty, please add some content." %}
        </div>
        <h1>{% trans "Edit" %} "{{ page.title }}"</h1>
        <form class="ui form" method="POST" action="" enctype="multipart/form-data" id="edit-form">
            {% csrf_token %}
            <div class="ui field">
                {{ form.content }}
            </div>
            <button class="ui right floated yellow button">{% trans "Submit" context "edit" %}</button>
            <a href="{% url "page" pk=page %}" class="ui right floated red button">
                {% trans "Cancel" context "abort action" %}
            </a>
        </form>
    </div>
{% endblock %}

{% block scripts %}
    <script>
        $("#edit-form").submit(() => {
            let filled = CKEDITOR.instances["id_content"].getData() !== "";
            let error_message = $("#empty-content-error")
            if (!filled && error_message.hasClass("hidden")) {
                error_message.transition("fade");
            }
            return filled;
        });

        $('.message .close').on('click', function () {
            $(this).closest('.message').transition("fade");
        });
    </script>
{% endblock %}