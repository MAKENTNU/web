{% extends "web/base.html" %}
{% load i18n %}

{% block body %}

    <div class="ui container">
        <h1>{{ event.title }}</h1>
        <a href="{% url "admin-event" event.pk %}">
            <i class="ui angle double left icon"></i>{% trans "Event admin page" %}
        </a>

        <h3>{% trans "Tickets" %}</h3>
        <b>{{ object.number_of_registered_tickets }}/{{ object.number_of_tickets }} {% trans "tickets reserved" %}</b>
        <div class="ui relaxed divided list">
            {% for ticket in tickets %}
                <div class="item">
                    <span class="right floated ">
                        {% if ticket.active %}
                            <span class="ui green label">{% trans "Active" %}</span>
                        {% else %}
                            <span class="ui red label">{% trans "Canceled" %}</span>
                        {% endif %}
                    </span>
                    <i class="ui very large middle aligned {% if ticket.active %}green{% else %}red{% endif %} circle icon"></i>
                    <div class="ui content">
                        <div class="header">
                            {{ ticket.name }} - <a href="mailto:{{ ticket.email }}">{{ ticket.email }}</a>
                        </div>
                        <div class="description">
                            <div>
                                <b>{% trans "Ref #" %}:</b>
                                <a href="{% url "ticket" ticket.uuid %}">{{ ticket.uuid }}</a>
                            </div>
                            <div>
                                <b>{% trans "Language" %}</b> {{ ticket.get_language_display }}
                            </div>
                            {% if ticket.comment %}
                                <div>
                                    <b>{% trans "Comment" %}:</b> {{ ticket.comment }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% empty %}
                {% trans "No tickets have been registered for this event" %}
            {% endfor %}
        </div>
        <h3>{% trans "Emails" %}<button class="copyToken"><i class="clipboard icon"></i></button></h3>
        <div style="width: 100%;">
            <input
                class="input-monospace copyInput"
                style="font-family: 'Courier New', Courier, monospace; width: 100%;"
                value="{% for ticket in tickets %}{% if ticket.active %}{{ ticket.email }},{% endif %}{% endfor %}"
                readonly>
        </div>
    </div>
    <script>
        var popupTimer;

        function delayPopup(popup) {
            popupTimer = setTimeout(function() { $(popup).popup('hide') }, 4200);
        }

        $(document).ready(function () {
            $('.copyToken').click(function (){
                clearTimeout(popupTimer);

                var $input = $(this).closest('div').find('.copyInput');

                /* Select the text field */
                $input.select();

                /* Copy the text inside the text field */
                document.execCommand("copy");

                $(this)
                    .popup({
                        title    : 'Successfully copied to clipboard!',
                        on: 'manual',
                        exclusive: true
                    })
                    .popup('show')
                ;

                // Hide popup after 5 seconds
                delayPopup(this);
            });
        });
    </script>
{% endblock %}
