{% load i18n %}
{% load datetime_tags %}


{# Linking `ticket_card.css` is required when including this template #}

<div class="ui ticket card">
    {% if not ticket.active %}
        <div class="ui red cancel label">
            {% trans "canceled"|capfirst %}
        </div>
    {% endif %}

    <div class="content">
        <div class="word-breaking header">
            <a href="{% url 'event_detail' ticket.registered_event.pk %}">
                {{ ticket.registered_event.title }}
            </a>
        </div>
        <div class="description">
            {% if ticket.event %}
                <div class="ui relaxed list">
                    {% for time_place in ticket.event.timeplaces.all %}
                        {% if not time_place.hidden %}
                            <div class="ui item">
                                {% include 'news/ticket_card_time_place.html' %}
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>
            {% else %}
                {% include 'news/ticket_card_time_place.html' with time_place=ticket.timeplace %}
            {% endif %}
        </div>
    </div>
    <div class="extra content">
        <p>
            <b>{% trans "language"|capfirst %}:</b> {{ ticket.get_language_display }}
        </p>
        {% if ticket.comment %}
            <p>
                <b>{% trans "comment"|capfirst %}:</b> {{ ticket.comment }}
            </p>
        {% endif %}
    </div>
    <div class="extra content">
        <b>{% trans "Ref #" %}:</b>
        <a href="{% url 'ticket_detail' ticket.pk %}">
            {{ ticket.uuid }}
        </a>
    </div>
    {% if ticket.active %}
        {% if ticket.user == request.user or perms.news.cancel_ticket %}
            <a class="ui red bottom attached button"
               href="{% url 'cancel_ticket' ticket.pk %}?next={{ request.path }}">
                {% trans "Cancel ticket" %}
            </a>
        {% endif %}
    {% elif perms.news.cancel_ticket %}
        <button class="ui green bottom attached button" type="submit"
                onclick="$('#reactivate-form-{{ ticket.pk }}').submit();">
            {% trans "Reactivate ticket" %}
        </button>
        <form id="reactivate-form-{{ ticket.pk }}"
              method="POST" action="{% url 'cancel_ticket' ticket.pk %}?next={{ request.path }}">
            {% csrf_token %}
        </form>
    {% endif %}
</div>
